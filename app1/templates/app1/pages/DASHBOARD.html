{% extends "base.html" %} 
{% load plotly_dash %} 


{% block content %} 

{% if user.is_authenticated %} 

<!-- NavBar -->
{% block navbar %} 
{% include './components/DASHBOARD_navbar.html' %} 
{% endblock navbar %}



<div class="container">

  <!-- BTC Table -->
  <div class="table-responsive-md">
    <table class="table table-sm">
      <thead class="">
        <tr>
          <th scope="col"> BTC Price (USD)</th>
          <th scope="col">24hr High</th>
          <th scope="col">24hr Low</th>
        </tr>
      </thead>
      <tbody class="text-left">
        {% for key,value in symbol.DISPLAY.items %}
        <tr>
          <td class="h2">{{value.USD.PRICE}}</td>
          <td>{{value.USD.HIGHDAY}}</td>
          <td>{{value.USD.LOWDAY}}</td>
        </tr>
        {% endfor %}
      </tbody>
    </table>
  </div>


<!-- Portfolio Table -->
<div class="table-responsive-sm">
  <table class="table table-sm">
    <thead class="">
      <tr>
        <th scope="col">BTC ({{btc_percentage}}%) </th>
        <th scope="col">USD ({{usd_percentage}}%)</th>
        <th scope="col">Portfolio Total</th>
      </tr>
    </thead>
    <tbody class="text-center">
      <tr>
        <td class='h3'>
          {{symbol.DISPLAY.BTC.USD.FROMSYMBOL}}{{bitcoin_balance}}
        </td>
        <td class="text-center h3">
            ${{usd_balance}}
        </td>
        <td class="text-center h2">
              ${{portfolio_balance}}
        </td>
      </tr>
      <tr>
        <td class='h5 text-center' colspan="2">
            {{symbol.DISPLAY.BTC.USD.FROMSYMBOL}}{{bitcoin_balance}} =
            ${{user_btc_balance}}
        </td>
        <td class="h6 text-center">
            ${{usd_balance}} +
            {{symbol.DISPLAY.BTC.USD.FROMSYMBOL}}{{bitcoin_balance}}
        </td>
      </tr>
    </tbody>
  </table>
  </div>

  <!-- BUY/SELL Interface -->
  <div class="container">
    <form class="form-inline" method="POST" action="{% url 'dashboard' %}" style=''>
      <div class="form-group mx-sm-3 mb-2">
        {% csrf_token %}
        <div class="input-group input-group-sm mb-3">
          <div class="form-check form-check-inline">
            <input class="form-check-input" type="radio" name="inlineRadioOptions" id="inlineRadio1" value="TRADE_BTC" checked="checked">
            <label class="form-check-label" for="inlineRadio1">Trade BTC</label>
          </div>
          <div class="form-check form-check-inline">
            <input class="form-check-input" type="radio" name="inlineRadioOptions" id="inlineRadio2" value="TRADE_USD">
            <label class="form-check-label" for="inlineRadio2">Trade USD</label>
          </div>
          <div class="input-group-prepend">
            <select name="BUY_SELL" class="buy-sell form-control custom-select">
              <option value="BUY">BUY</option>
              <option value="SELL">SELL</option>
            </select>
          </div>
          <input
          type=number 
          step=0.01 
          required="required"
          placeholder="Trade Amount..."
          aria-label="Search"
          name="BUY_BTC"
        />
        <div class="input-group-append">
          <button type="submit" class="btn btn-outline-secondary">
            Submit
          </button>
        </div>
        </div>
      </div>
    </form>
  </div>


  <!-- Error -->
  <div class="h5" style="text-decoration: red;">
    {{error}}
  </div>
  

  <!-- Transaction History Table (Foreign Key) -->
  <div class="container-sm">
  <div class="table-responsive-sm">
    <table class="table table-sm">
      <thead class="">
        <tr>
          <th scope="col">{{user}}</th>
          <th scope="col">BTC Price</th>
          <th scope="col">Trade</th>
          <th scope="col">Quantity</th>
          <th scope="col">Total</th>
        </tr>
      </thead>
      {% for transactions in transaction.all %}
      <tbody>
        <tr>
          <td>
            {{transactions.transaction_date}}
          </td>
          <td>
            ${{transactions.transaction_usd_price}}
          </td>
          <td>
            {{transactions.transaction_type}}
          </td>
          <td>
            {{transactions.transaction_btc_quantity}}
          </td>
          <td>
            ${{transactions.transaction_total_usd_price}}
          </td>
        </tr>
      </tbody>
      {% endfor %}
    </table>
  </div>
</div>

{% else %}

<!-- User Authentication Message -->
<div class="container">
  {% block login_message %}
  <p>Please <a href="{% url 'login' %}" class="">Login </a>to view this content</p>
  {% endblock login_message %}
</div>

{% endif %}

{% endblock %}
