{% extends "base.html" %} 
{% load plotly_dash %} 


{% block content %} 

{% if user.is_authenticated %} 

<!-- Time Series Chart-->
{% block navbar %} 
{% include './components/DASHBOARD_navbar.html' %} 
{% endblock navbar %}


<!-- Portfolio Table -->
<table class="table table-bordered table-hover">
  <thead class="thead-light">
    <tr>
      <th
       scope="col">Portfolio Balance (USD Value)</th>
       <th scope="col">Portfolio Bitcoin Value (BTC / USD)</th>
      <th scope="col">Portfolio USD Balance (CASH)</th>
    </tr>
  </thead>
  <tbody class="text-center">
    <tr>
      <td class="font-weight-bold">$ {{portfolio_balance}}</td>
      <td class="">
        <strong>{{bitcoin_balance}} BTC</strong> / ${{user_btc_balance}}
      </td>
      <td class="font-weight-bold">$ {{usd_balance}}</td>
    </tr>
  </tbody>
</table>


<!-- Time Series Chart -->
{% block cryptotable %} 
  {% plotly_direct name="crypto-chart2" %}
{% endblock cryptotable %}


<!-- BTC Table -->
<table class="table table-bordered table-hover">
  <thead class="thead-light">
    <tr>
      <th scope="col">Currency</th>
      <th scope="col">Price</th>
      <th scope="col">24hr High</th>
      <th scope="col">24hr Low</th>
      <th scope="col">Market Cap</th>
    </tr>
  </thead>
  <tbody>
    {% for key,value in symbol.DISPLAY.items %}
    <tr>
      <td class="font-weight-bold">{{key}}</td>
      <td class="font-weight-bold">{{value.USD.PRICE}}</td>
      <td>{{value.USD.HIGHDAY}}</td>
      <td>{{value.USD.LOWDAY}}</td>
      <td>{{value.USD.MKTCAP}}</td>
    </tr>
    {% endfor %}
  </tbody>
</table>


<!-- Buy/Sell Transactions -->
<div class="row" style="margin-top: 1rem;">
  <div class="col">
    <form class="form-inline" method="POST" action="{% url 'dashboard' %}">
      <div class="form-group mx-sm-3 mb-2">
        {% csrf_token %}
        <select name="BUY_SELL" class="buy-sell">
          <option value="BUY">BUY</option>
          <option value="SELL">SELL</option>
        </select>
        <input
          type="number"
          required="required"
          class="form-control"
          placeholder="BUY/SELL Amount..."
          aria-label="Search"
          name="BUY_BTC"
        />
      </div>
      <button type="submit" class="btn btn-outline-secondary mb-2">
        Submit
      </button>
      <div class='container' style="color:red">{{error}}</div>
    </form>
  </div>
</div>


<!-- Transaction Table (User One to One) -->
<table class="table table-bordered table-hover">
  <thead class="thead-light">
    <tr>
      <th scope="col">Username</th>
      <th scope="col">Transaction Date</th>
      <th scope="col">Transaction Type</th>
      <th scope="col">Symbol</th>
      <th scope="col">Quantity</th>
      <th scope="col">BTC Price (USD)</th>
      <th scope="col">Total (USD)</th>
    </tr>
  </thead>
  <tbody class="text-center">
    <tr>
      <td class="font-weight-bold">
        {{account_transactions.user}}
      </td>
      <td class="font-weight-bold">
        {{account_transactions.transaction_date}}
      </td>
      <td class="font-weight-bold">
        {{account_transactions.transaction_type}}
      </td>
      <td class="font-weight-bold">
        BTC
      </td>
      <td class="font-weight-bold">
        {{account_transactions.transaction_btc_quantity}}
      </td>
      <td class="font-weight-bold">
        {{account_transactions.transaction_usd_price}}
      </td>
      <td class="font-weight-bold">
        {{account_transactions.transaction_total_usd_price}}
      </td>
    </tr>
  </tbody>
</table>


<!-- Transaction History Table (Foreign Key) -->
<table class="table table-bordered table-hover">
  <thead class="thead-light">
    <tr>
      <th scope="col">Username</th>
      <th scope="col">Transaction Date</th>
      <th scope="col">Transaction Type</th>
      <th scope="col">Symbol</th>
      <th scope="col">Quantity</th>
      <th scope="col">BTC Price (USD)</th>
      <th scope="col">Total (USD)</th>
    </tr>
  </thead>
  {% for transactions in transaction.all %}
  <tbody class="text-center">
    <tr>
      <td class="font-weight-bold">
        {{transactions.user}}
      </td>
      <td class="font-weight-bold">
        {{transactions.transaction_date}}
      </td>
      <td class="font-weight-bold">
        {{transactions.transaction_type}}
      </td>
      <td class="font-weight-bold">
        BTC
      </td>
      <td class="font-weight-bold">
        {{transactions.transaction_btc_quantity}}
      </td>
      <td class="font-weight-bold">
        {{transactions.transaction_usd_price}}
      </td>
      <td class="font-weight-bold">
        {{transactions.transaction_total_usd_price}}
      </td>
    </tr>
  </tbody>
  {% endfor %}
</table>
{{transactions.first.user}}

{% else %}

<!-- User Authentication Message -->
<div class="container">
  {% block login_message %}
  <p>Please <a href="{% url 'login' %}" class="">Login </a>to view this content</p>
  {% endblock login_message %}
</div>

{% endif %}

{% endblock %}
